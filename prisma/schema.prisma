generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String    @id @default(cuid())
  phone      String    @unique
  name       String?
  role       Role      @default(CUSTOMER)
  preference String? // ذخیره انتخاب کاربر (daily, cafe, special, gift)

  addresses  Address[]
  sessions   Session[]
  createdAt  DateTime  @default(now())
}

model OTP {
  id        String   @id @default(cuid())
  phone     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

enum Role {
  ADMIN
  CUSTOMER
}

enum Preference {
  DAILY
  CAFE
  SPECIAL
  GIFT
}

model Address {
  id         Int     @id @default(autoincrement())
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String

  title      String   // عنوان آدرس: منزل، محل کار، ...
  province   String   // استان
  city       String   // شهر
  address    String   // متن کامل آدرس
  postalCode String?  // کدپستی
  phone      String   // شماره گیرنده

  isDefault  Boolean  @default(false)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Session {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  createdAt DateTime @default(now())
  expiresAt DateTime
}

//
// ========================
//   مدل محصول رستری قهوه
// ========================
//
model Product {
  id          Int       @id @default(autoincrement())
  name        String
  slug        String    @unique

  description String?
  price       Int
  imageUrl    String?

  // مبدا و اطلاعات کلی
  country     String?    // برزیل، کلمبیا، اتیوپی...
  region      String?    // منطقه داخل کشور (مثلاً Yirgacheffe)
  farm        String?    // مزرعه / تولیدکننده

  // سطح رست و فرآوری و رقم
  roastLevel  RoastLevel?   // LIGHT, MEDIUM, DARK
  process     ProcessType?  // WASHED, NATURAL, HONEY, ...
  variety     String?       // Bourbon, Typica, Geisha, ...

  // ارتفاع و امتیاز کاپینگ
  altitude     Int?         // ارتفاع کشت (متر)
  cuppingScore Float?       // امتیاز SCA (مثلاً 84.5)

  // متریک‌های طعمی (همگی اختیاری)
  flavorAcidity     Int?  // اسیدیته 0–100
  flavorSweetness   Int?  // شیرینی
  flavorBody        Int?  // بادی / غلظت
  flavorAroma       Int?  // عطر
  flavorBitter      Int?  // تلخی
  flavorComplexity  Int?  // پیچیدگی

  // نت‌های عطری (لیست – لازم نیست تو فرم پر بشه، پیش‌فرض آرایه خالی)
  notes        String[]   @default([]) // ["chocolate", "citrus", "nutty"]

  // روش‌های دم‌آوری پیشنهادی
  brewMethods  BrewMethod[] @default([]) // [ESPRESSO, V60, ...]

  // فلگ‌ها/ویژگی‌های فروشگاهی
  isRecommended  Boolean   @default(false) // برای "ویژه" بودن
  isAvailable    Boolean   @default(true)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

//
// =======================
//      enum های قهوه
// =======================
//

enum RoastLevel {
  LIGHT
  MEDIUM
  DARK
}

enum ProcessType {
  WASHED
  NATURAL
  HONEY
  ANAEROBIC
  CARBONIC_MACERATION
  EXPERIMENTAL
}

enum BrewMethod {
  ESPRESSO
  V60
  AEROPRESS
  FRENCH_PRESS
  MOKAPOT
  CHEMEX
  COLD_BREW
  TURKISH
}
